(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"fec4067f-f71a-4209-9bf0-a47e5ffd1c2c","Content-Type":"application/json"}};function t(){return fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(res.status))}))}function n(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&r(t)}}function o(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}document.addEventListener("click",(function(e){e.target.classList.contains("popup_is-opened")&&r(e.target)}));var c=document.querySelector(".popup_type_image");function u(t,n){var r=document.getElementById("card-template").content.cloneNode(!0),u=r.querySelector(".card__image"),a=r.querySelector(".card__title"),i=r.querySelector(".card__like-button"),d=r.querySelector(".card__delete-button"),l=r.querySelector(".card__likes-count");return u.src=t.link,u.alt=t.name,a.textContent=t.name,l.textContent=t.likes.length,t.owner._id===n?(d.style.display="block",d.addEventListener("click",(function(){var n;(n=t._id,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){if(!e)throw new Error("Ошибка удаления карточки: ".concat(e.status));return e.json()}))).then((function(){console.log("Карточка удалена");var e=d.closest(".card");e&&e.remove()})).catch((function(e){return console.error(e)}))}))):d.style.display="none",t.likes.some((function(e){return e._id===n}))?i.classList.add("card__like-button_is-active"):i.classList.remove("card__like-button_is-active"),i.addEventListener("click",(function(){var n;i.classList.toggle("card__like-button_is-active"),t._id?i.classList.contains("card__like-button_is-active")?(n=t._id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then((function(e){if(!e.ok)throw new Error("Ошибка добавления лайка: ".concat(e.status));return e.json()}))).then((function(e){console.log("Лайк поставлен",e),l.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){if(!e.ok)throw new Error("Ошибка удаления лайка: ".concat(e.status));return e.json()}))}(t._id).then((function(e){console.log("Лайк убран",e),l.textContent=e.likes.length})).catch((function(e){return console.log(e)})):console.error("ID карточки не определен")})),u.addEventListener("click",(function(){var e=c.querySelector(".popup__image"),n=c.querySelector(".popup__caption");e.src=t.link,e.alt=t.name,n.textContent=t.name,o(c)})),r}var a=function(e,t){var n=!0;e.forEach((function(e){e.validity.valid?d(e):(n=!1,i(e))})),t.classList.toggle("popup__button_state_inactive",!n),t.disabled=!n},i=function(e){var t=document.querySelector(".".concat(e.name,"-error"));t&&(t.textContent=e.validity.valueMissing?"Вы пропустили это поле.":e.validity.typeMismatch?"Введите корректный URL.":e.validity.tooShort?"Минимальное количество символов: 2.":"")},d=function(e){var t=document.querySelector(".".concat(e.name,"-error"));t&&(t.textContent="")},l=function(e){try{return new URL(e),!0}catch(e){return!1}},s=document.querySelector(".popup_type_edit"),p=document.querySelector(".popup_type_new-card"),_=document.querySelector(".profile__edit-button"),f=document.querySelector(".profile__add-button"),v=document.querySelector(".profile__edit-icon"),y=document.querySelector(".popup_type_edit-avatar"),m=document.querySelector('.popup__form[name="edit-avatar"]');document.addEventListener("DOMContentLoaded",(function(){document.querySelector(".popup"),document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated")}))}));var h=document.querySelector(".places__list");function S(e,t){e.textContent=t}document.addEventListener("DOMContentLoaded",(function(){t().then((function(e){var t=document.querySelector(".profile__title"),n=document.querySelector(".profile__image"),o=document.querySelector(".profile__description");t.textContent=e.name,n.style.backgroundImage="url(".concat(e.avatar,")"),o.textContent=e.about})).catch((function(e){console.error("Не удалось загрузить данные пользователя:",e)}))})),document.addEventListener("DOMContentLoaded",(function(){var n;t().then((function(t){return n=t._id,fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})).then((function(e){!function(e,t){e.forEach((function(e){var n=u(e,t);h.append(n)}))}(e,n)})).catch((function(e){console.log(e)}))})),v.addEventListener("click",(function(){o(y)})),_.addEventListener("click",(function(){o(s)})),f.addEventListener("click",(function(){o(p)})),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(e){r(e.target.closest(".popup"))}))})),document.addEventListener("DOMContentLoaded",(function(){var t=document.querySelector('.popup__button[type="submit"]'),n=document.querySelector(".popup__input_type_name"),o=document.querySelector(".popup__input_type_description"),c=document.querySelector(".profile__title"),u=document.querySelector(".profile__description");t.disabled=!0,t&&t.addEventListener("click",(function(a){a.preventDefault();var i,d,l=n.value,p=o.value,_=t,f=_.textContent;S(_,"Сохранение..."),(i=l,d=p,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:i,about:d})}).then((function(e){if(!e.ok)throw new Error("Ошибка при обновлении профиля ".concat(e.status));return e.json()})).then((function(e){return console.log("Профиль обновлен:",e),e}))).then((function(e){c.textContent=l,u.textContent=p,r(s)})).catch((function(e){console.log(e)})).finally((function(){S(_,f)}))}))})),m.addEventListener("submit",(function(t){t.preventDefault();var n=y.querySelector(".popup__input_type_avatar-url"),o=n.value;console.log("URL для обновления аватара:",o);var c,u=m.querySelector(".popup__button"),i=u.textContent;S(u,"Сохранение..."),(c=o,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:c})}).then((function(e){if(!e.ok)throw new Error("Ошибка при обновлении аватара: ".concat(e.status));return e.json()}))).then((function(e){console.log("Аватар обновлен:",e),document.querySelector(".profile__image").style.backgroundImage="url(".concat(e.avatar,")"),r(m),m.reset(),a([n],m.querySelector(".popup__button"))})).catch((function(e){console.error("Не удалось обновить аватар:",e)})).finally((function(){S(u,i)}))}));var q=document.querySelector('.popup__form[name="new-place"]');q.addEventListener("submit",(function(t){t.preventDefault();var n=q.querySelector(".popup__input_type_card-name").value,o=q.querySelector(".popup__input_type_url").value;if(Array.from(h.children).some((function(e){var t=e.querySelector(".card__title").textContent,r=e.querySelector(".card__image").getAttribute("src");return t===n&&r===o})))alert("Карточка с таким именем и ссылкой уже существует!");else{var c={name:n,link:o},a=q.querySelector('button[type="submit"]');a.disabled=!0;var i,d=q.querySelector(".popup__button"),l=a.textContent;S(d,"Сохранение..."),(i=c,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify(i)}).then((function(e){if(!e.ok)throw new Error("Ошибка при создании карточки: ".concat(e.status));return e.json()}))).then((function(e){var t=u(e);h.prepend(t),r(p),q.reset()})).catch((function(e){console.log(e)})).finally((function(){S(a,l),a.disabled=!1}))}})),document.addEventListener("DOMContentLoaded",(function(){var e,t,n,o,c=document.querySelector('.popup__form[name="edit-profile"]');t=(e=c).querySelector(".popup__input_type_name"),n=e.querySelector(".popup__input_type_description"),(o=e.querySelector(".popup__button")).classList.add("popup__button_state_inactive"),o.disabled=!0,t.addEventListener("input",(function(){return a([t,n],o)})),n.addEventListener("input",(function(){return a([t,n],o)})),e.addEventListener("submit",(function(e){if(e.preventDefault(),t.validity.valid&&n.validity.valid){var o=document.querySelector(".profile__title"),c=document.querySelector(".profile__description");o.textContent=t.value,c.textContent=n.value,r(document.querySelector(".popup_type_edit"))}})),function(e){var t=e.querySelector(".popup__input_type_avatar-url"),n=e.querySelector(".popup__button");n.classList.add("popup__button_state_inactive"),n.disabled=!0,t.addEventListener("input",(function(){return a([t],n)})),e.addEventListener("submit",(function(o){o.preventDefault(),l(t.value)&&(r(document.querySelector(".popup_type_edit-avatar")),e.reset(),a([t],n))}))}(m),function(e,t,n){var o=e.querySelector(".popup__input_type_card-name"),c=e.querySelector(".popup__input_type_url"),i=e.querySelector(".popup__button");i.classList.add("popup__button_state_inactive"),i.disabled=!0,o.addEventListener("input",(function(){return a([o,c],i)})),c.addEventListener("input",(function(){return a([o,c],i)})),e.addEventListener("submit",(function(d){if(d.preventDefault(),o.validity.valid&&l(c.value)){var s=u({name:o.value,link:c.value});t.prepend(s),r(n),e.reset(),a([o,c],i)}}))}(document.querySelector('.popup__form[name="new-place"]'),h,p)}))})();